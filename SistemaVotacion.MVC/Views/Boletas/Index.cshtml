@using System.Linq
@using SistemaVotacion.Modelos
@model List<SistemaVotacion.Modelos.Lista>

@{
    ViewData["Title"] = "Boleta";
    Layout = null;
    var fechaFin = ViewBag.FechaFinVotacion as string;

    // Función helper para comparar dignidades sin problemas de mayúsculas ni espacios
    string NormalizarDignidad(string? nombre) =>
        string.IsNullOrWhiteSpace(nombre)
            ? string.Empty
            : nombre.Trim().ToLowerInvariant();
}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <title>Boleta Electoral</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" href="~/css/Boleta.css" />
</head>
<body>

    <h1>Boleta Electoral</h1>
    <p>Código validado: @ViewBag.Codigo</p>
    <p>Debug FechaFin: @fechaFin</p>

    <div class="contador-elecciones">
        <span class="titulo">Tiempo restante</span>
        <span id="tiempo-restante">--:--:--</span>
    </div>

    <form asp-controller="Boletas"
          asp-action="Index"
          method="post">

        <input type="hidden" name="codigo" value="@ViewBag.Codigo" />

        <div class="boleta-container">

            <div class="boleta-header">
                <h1>Elecciones Generales</h1>
                <p>Seleccione un binomio presidencial</p>
            </div>

            <div class="boleta-opciones">

                @if (Model != null && Model.Count > 0)
                {
                    foreach (var lista in Model)
                    {
                        var presidente = lista.Candidatos?
                        .FirstOrDefault(c => NormalizarDignidad(c.Dignidad?.NombreDignidad) == "presidente");

                        var vicepresidente = lista.Candidatos?
                        .FirstOrDefault(c => NormalizarDignidad(c.Dignidad?.NombreDignidad) == "vicepresidente");

                        var logoLista = lista.RecursosMultimedia?
                        .FirstOrDefault()?.UrlFoto ?? "img/default-lista.png";

                        var fotoPresidente = presidente?.GaleriaMultimedia?
                        .FirstOrDefault()?.UrlFoto ?? "img/default-persona.png";

                        var fotoVicepresidente = vicepresidente?.GaleriaMultimedia?
                        .FirstOrDefault()?.UrlFoto ?? "img/default-persona.png";

                        <label class="opcion-card">
                            <input type="radio"
                                   name="idLista"
                                   value="@lista.Id"
                                   required />

                            <div class="opcion-content">
                                <div class="partido">
                                    <img src="~/@logoLista" />
                                    <div>
                                        <strong>@lista.NombreLista</strong><br />
                                        <span class="lista">Lista @lista.NumeroLista</span>
                                    </div>
                                </div>

                                <div class="binomio">
                                    <div class="persona">
                                        <img src="~/@fotoPresidente" />
                                        <span class="cargo">Presidente</span>
                                        <span class="nombre">@presidente?.NombreCandidato</span>
                                    </div>

                                    <div class="persona">
                                        <img src="~/@fotoVicepresidente" />
                                        <span class="cargo">Vicepresidente</span>
                                        <span class="nombre">@vicepresidente?.NombreCandidato</span>
                                    </div>
                                </div>
                            </div>
                        </label>
                    }
                }
                else
                {
                    <p>No hay boletas disponibles para mostrar.</p>
                }
            </div>

            <div class="acciones">
                <button type="submit" class="btn-votar">
                    VOTAR
                </button>
            </div>

        </div>
    </form>


    <div class="contador-elecciones">
        <span class="titulo">Tiempo restante</span>
        <span id="tiempo-restante">00:15:00</span>
    </div>


</body>
</html>
