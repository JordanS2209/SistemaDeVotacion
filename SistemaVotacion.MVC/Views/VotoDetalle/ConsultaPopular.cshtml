@{
    ViewData["Title"] = "Resultados Consulta Popular";
}
@{
    if (ViewBag.IdPadron == null || ViewBag.IdProceso == null)
    {
        <h3>Error: no se pudo cargar la boleta</h3>
        return;
    }

    int idPadron = (int)ViewBag.IdPadron;
    int idProceso = (int)ViewBag.IdProceso;
}


<link rel="stylesheet" href="~/css/ResultadosConsultaPopular.css" />
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<h2 class="titulo-principal">Resultados Consulta Popular</h2>

<!-- =======================
     RESUMEN GENERAL
     ======================= -->
<div class="contenedor-principal">

    <div class="card-grafica">
        <h3 class="titulo-grafica">Resumen General</h3>
        <canvas id="graficaResumen"></canvas>
    </div>

</div>

<!-- =======================
     RESULTADOS POR PREGUNTA
     ======================= -->
<div class="contenedor-preguntas" id="contenedorPreguntas"></div>

<script>
    const resumen = @Html.Raw(ViewBag.Resumen ?? "{}");
    const preguntas = @Html.Raw(ViewBag.Preguntas ?? "[]");

    /* =======================
       GRAFICA GENERAL
       ======================= */
    new Chart(document.getElementById('graficaResumen'), {
        type: 'doughnut',
        data: {
            labels: ['SÍ', 'NO', 'BLANCOS'],
            datasets: [{
                data: [
                    resumen.si ?? 0,
                    resumen.no ?? 0,
                    resumen.blancos ?? 0
                ],
                backgroundColor: ['#2e7d32', '#c62828', '#9e9e9e']
            }]
        },
        options: {
            plugins: {
                legend: { position: 'bottom' }
            }
        }
    });

    /* =======================
       PREGUNTAS
       ======================= */
    const contenedor = document.getElementById("contenedorPreguntas");

    preguntas.forEach(p => {

        const card = document.createElement("div");
        card.className = "pregunta-card";

        card.innerHTML = `
            <h4 class="texto-pregunta">${p.texto}</h4>

            <div class="datos">
                <span class="si">SÍ: ${p.si}</span>
                <span class="no">NO: ${p.no}</span>
                <span class="blanco">BLANCOS: ${p.blancos}</span>
            </div>

            <canvas id="grafica_${p.id}" height="120"></canvas>
        `;

        contenedor.appendChild(card);

        new Chart(document.getElementById(`grafica_${p.id}`), {
            type: 'bar',
            data: {
                labels: ['SÍ', 'NO', 'BLANCOS'],
                datasets: [{
                    data: [p.si, p.no, p.blancos],
                    backgroundColor: ['#2e7d32', '#c62828', '#9e9e9e']
                }]
            },
            options: {
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });
    });
</script>
